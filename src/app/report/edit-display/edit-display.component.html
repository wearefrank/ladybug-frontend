@if (displayReport) {
  <div data-cy-test-editor="root" class="d-flex flex-row justify-content-between align-items-center" id="displayButtons">
    <div class="d-flex flex-row align-items-center" data-cy-debug-editor="buttons">
      <app-button data-cy-debug-editor="close" icon="fa fa-times" title="Close" (click)="closeReport(false)"/>
      <app-button *ngIf="report.xml" text="Rerun" title="Rerun this report" (click)="rerunReport()"/>
      @if (!editingRootNode && !editingChildNode) {
        <app-button data-cy-test-editor="edit" icon="fa fa-edit" title="Edit" (click)="editReport()"/>
      } @else if (editingChildNode || editingRootNode) {
        <app-button icon="fa fa-trash" title="Discard Changes" (click)="openDifferenceModal('discard')"/>
        <app-button data-cy-test-editor="save" icon="fa fa-save" title="Save" (click)="openDifferenceModal('save')"/>
      }
      @if (report.encoding === 'Base64') {
        <app-button text="Base64" title="Convert to Base64" (click)="changeEncoding($event)"/>
      }
      @if (!newTab) {
        <app-button data-cy-debug-editor="copy" icon="fa fa-copy" title="Copy" (click)="copyReport()"/>
      }

      <div ngbDropdown title="Download">
        <button ngbDropdownToggle data-cy-test-editor="download" class="btn btn-info">
          <i class="fa fa-download px-2"></i><span class="caret"></span>
        </button>
        <div ngbDropdownMenu>
          <button ngbDropdownItem (click)="downloadReport(true, true)">XML & Binary</button>
          <button ngbDropdownItem (click)="downloadReport(false, true)">
            XML
            <i class="fa fa-info-circle" title="Only a binary file can be uploaded again"></i>
          </button>
          <button ngbDropdownItem (click)="downloadReport(true, false)">Binary</button>
        </div>
      </div>

      @if (report.stub) {
        <div class="w-fit mx-1 my-0">
          <select class="form-control" (change)="selectStubStrategy($event)">
            <option [value]="-1" [selected]="report.stub === -1">Use report level stub strategy</option>
            <option [value]="0" [selected]="report.stub === 0">Always stub this checkpoint</option>
            <option [value]="1" [selected]="report.stub === 1">Never stub this checkpoint</option>
          </select>
        </div>
      }

      <div data-cy-test-editor="readonlyLabel" class="w-fit h-fit btn btn-static my-2 mx-1 px-2">
        Editing code is:
        <span [style.color]="editingEnabled ? 'green' : 'red'">{{ editingEnabled|booleanToString:'ON': 'OFF' }}</span>
      </div>
      <button data-cy-open-metadata-table
              class="btn btn-info my-2 mx-1 px-3 h-fit"
              title="Open metadata table"
              (click)="toggleMetadataTable()">
        {{ metadataTableVisible|booleanToString:'Hide':'Show' }} metadata
      </button>
    </div>
    @if (report.name) {
      <h4 [cdkCopyToClipboard]="report.name" data-cy-metadata-table="reportname" class="my-auto report-name">{{ report.name }}</h4>
    }
    <div class="mr-2" style="cursor: pointer;" title="Show possibilities with editor" (click)="showEditorPossibilitiesModal(possibilitiesModal)">
      <i class="bi bi-info-circle info-circle-size"></i>
    </div>
  </div>


  <div>
    {{ rerunResult }}
  </div>
  @if (metadataTableVisible) {
    <app-display-table [report]="report"/>
  }
}

@if (editingRootNode) {
  <app-edit-form [report]="report"/>
} @else {
  <app-custom-editor
    [readOnlyMode]="!editingChildNode"
    [height]="containerHeight - 24"
    data-cy-test-editor="editor"/>
}

<app-difference-modal/>

<ng-template #possibilitiesModal let-modal>
  <div class="modal-header d-flex align-items-center">
    <div class="modal-title h5">Possibilities for editor</div>
    <button type="button" class="close" (click)="modal.dismiss()">&times;</button>
  </div>
  <div class="modal-content pt-3 fs-3">
    <p class="text-center mx-4 text-danger h6">
      Please make sure that the editor is focused when running commands, which is shown with the eye
      <i class="bi bi-eye-fill text-dark"></i>
      icon.
    </p>
    <br>
    <br>
    <div class="mx-auto text-left">
      <p><kbd>F1</kbd>: Show all possible commands</p>
      <p><kbd>Ctrl + F</kbd>: Search document</p>
      <p><kbd>Ctrl + G</kbd>: Go to line/column</p>
      <p><kbd>Ctrl + A</kbd>: Select all</p>
    </div>
  </div>
</ng-template>
